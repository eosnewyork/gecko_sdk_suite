name=mbed TLS
description=This plugin includes the cryptographic algorithms that meet Silicon Labs Connect Stack requirements.

category=Connect Utility
quality=alpha
includedByDefault=false

architecture=efr32~series[1]

providedApis=mbedtls

setup(template) {
  mallocHeapSize=8192
}

sourceFiles=
stack-overrides.c
$MBEDTLS/library/ecp.c
$MBEDTLS/library/ecdh.c
$MBEDTLS/library/bignum.c
$MBEDTLS/library/ecp_curves.c
$MBEDTLS/library/aes.c
$MBEDTLS/library/sha256.c
$MBEDTLS/library/ctr_drbg.c
$MBEDTLS/library/entropy.c
$MBEDTLS/library/ccm.c
$MBEDTLS/library/cmac.c
$MBEDTLS/library/cipher.c
$MBEDTLS/library/cipher_wrap.c
$MBEDTLS/library/threading.c

$MBEDTLS/sl_crypto/src/aes_aes.c
$MBEDTLS/sl_crypto/src/crypto_aes.c
$MBEDTLS/sl_crypto/src/crypto_ble.c
$MBEDTLS/sl_crypto/src/crypto_ecp.c
$MBEDTLS/sl_crypto/src/crypto_management.c
$MBEDTLS/sl_crypto/src/crypto_sha.c
$MBEDTLS/sl_crypto/src/entropy_adc.c
$MBEDTLS/sl_crypto/src/entropy_rail.c
$MBEDTLS/sl_crypto/src/radioaes_aes.c
$MBEDTLS/sl_crypto/src/radioaes_ble.c
$MBEDTLS/sl_crypto/src/se_aes.c
$MBEDTLS/sl_crypto/src/se_ccm.c
$MBEDTLS/sl_crypto/src/se_cmac.c
$MBEDTLS/sl_crypto/src/se_ecp.c
$MBEDTLS/sl_crypto/src/se_sha.c
$MBEDTLS/sl_crypto/src/se_trng.c
$MBEDTLS/sl_crypto/src/shax.c
$MBEDTLS/sl_crypto/src/trng.c

$SILABS_CORE/memory_manager/sl_malloc.c

options=runOnMicrium,runBareMetal

runOnMicrium.name=This option is enabled if Micrium OS plugin is enabled.
runOnMicrium.type=BOOLEAN
runOnMicrium.hidden=TRUE
runOnMicrium.default=true
runOnMicrium.enabledIf=conf.isApiProvided("micrium-rtos")
runOnMicrium.macro=-DMBEDTLS_MICRIUMOS=1
runOnMicrium.macro=-DMBEDTLS_CONFIG_FILE="config-micrium.h"

runBareMetal.name=This option is enabled if the application is running bare metal (Micrium OS plugin is disabled).
runBareMetal.type=BOOLEAN
runBareMetal.hidden=TRUE
runBareMetal.default=true
runBareMetal.enabledIf=!conf.isApiProvided("micrium-rtos")
runBareMetal.macro=-DMBEDTLS_CONFIG_FILE="config-bare-metal.h"

setup(additionalFiles) {
  PATH(ABSOLUTE):$FRAMEWORK/plugins/mbedtls/config
  PATH(ABSOLUTE):$MBEDTLS
  PATH(ABSOLUTE):$MBEDTLS/include/mbedtls
  PATH(ABSOLUTE):$MBEDTLS/include
  PATH(ABSOLUTE):$MBEDTLS/sl_crypto/include
}